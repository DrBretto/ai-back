import Moment from 'Moment'
import jsonHoliday from './data/data.json'

import moving from './moving/index.js'

export default function (country,year,state) {
    let holidays = JSON.parse(JSON.stringify(jsonHoliday[country].holidays));

    if(state != null){
        let stateHolidays = jsonHoliday[country].states[state].holidays;
        holidays = holidays.concat(stateHolidays);
    }

    //if date is not something like 24.12
    let reg = /\d+.\d+/;
    holidays.map(holiday => {
        if(!holiday.date.match(reg)){
            let sp = holiday.date.split(' ');
            let time;
            let timeObj;
            
            timeObj = moving[sp[0]](year);
            let mmnt = Moment(`${timeObj.year}-${timeObj.month}-${timeObj.day}`,'YYYY-MM-DD').utcOffset(2);
            
            if(sp[1] === '-'){
                time = mmnt.clone().subtract(sp[2],'days')
            } else if (sp[1] === '+'){
                time = mmnt.clone().add(sp[2],'days') 
            }
            holiday.date = time.format('D.M')
        }
    })

    return holidays
}